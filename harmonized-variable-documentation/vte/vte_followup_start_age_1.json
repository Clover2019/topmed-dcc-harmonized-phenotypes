{
  "name": "vte_followup_start_age_1",
  "phenotype_concept": "vte_followup_start_age",
  "concept_variant": 1,
  "description": "Age of subject at the start of the follow up period during which venous thromboembolism (VTE) events were reviewed and adjudicated.",
  "version": 1,
  "dcc_harmonization_id": 119,
  "data_type": "decimal",
  "measurement_units": "years",
  "has_age_variable": false,
  "date_harmonized": "2018-10-29 15:19:09",
  "dcc_harmonization_comments": "This phenotype is harmonized for the large cohort studies to facilitate the creation of age strata to be used in matching cases and controls within a study.\n\nFor studies/sub-cohorts where the adjudication started at the beginning of the study, the age at enrollment into the study was used. For studies/sub-cohorts where the adjudication started at a later time point, harmonization was specific to the study. In general, the ages were computed as: \n```\n      age at reference time + (days between reference time and adjudication start) / 365.25\n```\nFor more details on adjudication processes, see the analyst comments for the harmonized case status variable.\n\n### Study-specific comments\n\n#### WHI\n\nVTE events were adjudicated from the start of the study for subjects in the HRT (hormone replacement therapy) trial. The harmonized variable for HRT subjects was set to the age at enrollment, which was computed from age at screening and days between screening and enrollment.\n\nVTE events for subjects from the MRC (medical records cohort; not in the HRT trial) were adjudicated starting with the beginning of Extension 2.  For these MRC subjects, the harmonized variable was set to the age at the beginning of Extension 2, computed from age at enrollment and the days between enrollment and the start of Extension 2.\n\n#### FHS\n##### Original and Offspring sub-cohorts\n \nVTE event adjudication started January 1, 1995. For the Original sub-cohort, the exam closest to the start was Exam 24. For the Offspring sub-cohort, the exam closest to the start was Exam 6. If a subject attended the pre-specified exam, the age at the start of adjudication was computed using the age at Exam 1 and the number of days between Exam 1 and the pre-specified exam. If a subject did not attend the pre-specified exam but did attend either the exam immediately preceding or immediately following the pre-specified exam, the number of days to the pre-specified exam was approximated using the average number of days between exams over all subjects who did attend the pre-specified exam. If a subject did not attend either the pre-specified exam or the immediately preceding or following exam, no age was assigned.\n\n(Note that for the Generation 3, New Offspring Spouse, Omni1 and Omni2 cohorts, adjudication started at Exam 1 so the harmonized variable was set to the age at Exam 1.)\n",
  "encoded_values": [],
  "controlled_vocabulary": [],
  "harmonization_units": [
    {
      "name": "ARIC",
      "component_study_variables": ["phs000280.v4.pht004063.v2.phv00204712.v1", "phs000280.v4.pht006485.v1.phv00298125.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n\n  # age at start of VTE follow-up for ARIC\n  # follow-up started at visit1 so age = age at visit1\n\n  # get dataset with age at visit 1 information\n  # get dataset including the subjects followed for VTE\n  # join to keep subjects followed for VTE\n\n  dat1 <- phen_list$source_data$pht004063\n  dat2 <- phen_list$source_data$pht006485\n  dat <- left_join(dat2, dat1)\n\n  # assign age as age at visit 1\n  # keep only non-missing information\n\n   dat <- dat %>% mutate(vte_followup_start_age = as.numeric(V1AGE01)) %>%\n         filter(!is.na(vte_followup_start_age)) %>%\n         select(topmed_subject_id, vte_followup_start_age)\n\n  return(dat)\n}\n"
    },
    {
      "name": "CHS",
      "component_study_variables": ["phs000287.v6.pht001452.v1.phv00100487.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n\n  # age at start of VTE follow-up for CHS\n  # follow-up started at baseline so age = age at CHS baseline\n\n  # get dataset with age at CHS baseline information\n\n  dat <- phen_list$source_data$pht001452\n\n  # assign age as age at CHS baseline\n  # keep only non-missing information\n\n   dat <- dat %>% mutate(vte_followup_start_age = as.numeric(AGEBL)) %>%\n         filter(!is.na(vte_followup_start_age)) %>%\n         select(topmed_subject_id, vte_followup_start_age)\n\n  return(dat)\n}\n"
    },
    {
      "name": "FHS_G3NOSOm12",
      "component_study_variables": ["phs000007.v29.pht003099.v4.phv00177928.v4", "phs000007.v29.pht003099.v4.phv00177930.v4"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n\n  # age at start of VTE follow-up for FHS NOS, Gen3, Omni1, and Omni2\n  # follow-up started at visit1 so age = age at visit1\n\n  # get dataset with sub-cohort indicator and visit information\n  # select the given subcohorts: NOS = 2, Gen3 = 3, Omni1 = 7, Omni2 = 72\n  # assign age as age at visit 1\n  # keep only non-missing information\n\n  dat <- phen_list$source_data$pht003099 %>%\n         filter(idtype %in% c(2, 3, 7, 72)) %>%\n         mutate(vte_followup_start_age = as.numeric(age1)) %>%\n         filter(!is.na(vte_followup_start_age)) %>%\n         select(topmed_subject_id, vte_followup_start_age)\n\n  return(dat)\n}\n"
    },
    {
      "name": "FHS_Offspring",
      "component_study_variables": ["phs000007.v29.pht003099.v4.phv00177928.v4", "phs000007.v29.pht003099.v4.phv00177930.v4", "phs000007.v29.pht003099.v4.phv00177937.v4", "phs000007.v29.pht003099.v4.phv00177939.v4", "phs000007.v29.pht003099.v4.phv00177941.v4", "phs000007.v29.pht003099.v4.phv00177988.v4", "phs000007.v29.pht003099.v4.phv00177989.v4", "phs000007.v29.pht003099.v4.phv00177990.v4"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n\n  # age at start of VTE follow-up for FHS Offspring\n  # follow-up started at visit6 so age = age at visit6\n  # unless subject did not attend visit6 - will then need to approximate\n  # will use visit5 and/or visit7 in approximation\n\n  # get dataset with sub-cohort indicator and visit information\n  # select the given subcohorts: idtype for Offspring = 1\n\n  dat <- phen_list$source_data$pht003099 %>%\n         filter(idtype %in% 1)\n\n  # change age and days to numeric\n  dat$age1 <- as.numeric(dat$age1)\n  dat$date6 <- as.numeric(dat$date6)\n  dat$date5 <- as.numeric(dat$date5)\n  dat$date7 <- as.numeric(dat$date7)\n\n  # approximate date6 for subjects that did not attend visit6\n  # find average number of days between visit5 and visit6\n  #   for subjects attending both visit5 and visit6\n  # find average number of days between visit7 and visit6\n  #   for subjects attending both visit7 and visit6\n\n  days56 <- mean(dat$date6 - dat$date5, na.rm = TRUE)\n  days67 <- mean(dat$date7 - dat$date6, na.rm = TRUE)\n\n  a <- dat$att6 %in% 0\n  b1 <- dat$att5 %in% 1\n  b2 <- dat$att7 %in% 1\n\n  # approximate date6 for subjects not attending visit6\n  # use days56 if attended visit 5 but not 7\n  s1 <- a & b1 & !b2\n  dat$date6[s1] <- dat$date5[s1] + days56\n\n  # use days67 if attended visit 7 but not 5\n  s2 <- a & !b1 & b2\n  dat$date6[s2] <- dat$date7[s2] - days67\n\n  # use average if attended both 5 and 7\n  s3 <- a & b1 & b2\n  tmp <- rbind(dat$date5[s3] + days56, dat$date7[s3] - days67)\n  dat$date6[s3] <- colMeans(tmp)\n\n  # assign age at vte followup start as age at visit6 (some approximate)\n  # if did not attend visit 5 or 6 or 7, will be missing and then deleted\n  dat <- dat %>%\n         mutate(vte_followup_start_age = age1 + date6 / 365.25) %>%\n         filter(!is.na(vte_followup_start_age)) %>%\n         select(topmed_subject_id, vte_followup_start_age)\n\n  return(dat)\n}\n"
    },
    {
      "name": "FHS_Original",
      "component_study_variables": ["phs000007.v29.pht003099.v4.phv00177928.v4", "phs000007.v29.pht003099.v4.phv00177930.v4", "phs000007.v29.pht003099.v4.phv00177973.v4", "phs000007.v29.pht003099.v4.phv00177975.v4", "phs000007.v29.pht003099.v4.phv00177977.v4", "phs000007.v29.pht003099.v4.phv00178006.v4", "phs000007.v29.pht003099.v4.phv00178007.v4", "phs000007.v29.pht003099.v4.phv00178008.v4"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n\n  # age at start of VTE follow-up for FHS Original\n  # follow-up started at visit24 so age = age at visit24\n  # unless subject did not attend visit24 - will then need to approximate\n  # will use visit23 and/or visit25 in approximation\n\n  # get dataset with sub-cohort indicator and visit information\n  # select the given subcohorts: idtype for Original = 0\n\n  dat <- phen_list$source_data$pht003099 %>%\n         filter(idtype %in% 0)\n\n  # change age and days to numeric\n  dat$age1 <- as.numeric(dat$age1)\n  dat$date24 <- as.numeric(dat$date24)\n  dat$date23 <- as.numeric(dat$date23)\n  dat$date25 <- as.numeric(dat$date25)\n\n  # approximate date24 for subjects that did not attend visit24\n  # find average number of days between visit23 and visit24\n  #   for subjects attending both visit23 and visit24\n  # find average number of days between visit25 and visit24\n  #   for subjects attending both visit25 and visit24\n\n  days2324 <- mean(dat$date24 - dat$date23, na.rm = TRUE)\n  days2425 <- mean(dat$date25 - dat$date24, na.rm = TRUE)\n\n  a <- dat$att24 %in% 0\n  b1 <- dat$att23 %in% 1\n  b2 <- dat$att25 %in% 1\n\n  # approximate date24 for subjects not attending visit24\n  # use days2324 if attended visit 23 but not 25\n  s1 <- a & b1 & !b2\n  dat$date24[s1] <- dat$date23[s1] + days2324\n\n  # use days2425 if attended visit 25 but not 23\n  s2 <- a & !b1 & b2\n  dat$date24[s2] <- dat$date25[s2] - days2425\n\n  # use average if attended both 23 and 25\n  s3 <- a & b1 & b2\n  tmp <- rbind(dat$date23[s3] + days2324, dat$date25[s3] - days2425)\n  dat$date24[s3] <- colMeans(tmp)\n\n  # assign age at vte followup start as age at visit24 (some approximate)\n  # if did not attend visit23 or 24 or 25, will be missing and then deleted\n  dat <- dat %>%\n         mutate(vte_followup_start_age = age1 + date24 / 365.25) %>%\n         filter(!is.na(vte_followup_start_age)) %>%\n         select(topmed_subject_id, vte_followup_start_age)\n\n  return(dat)\n}\n"
    },
    {
      "name": "WHI_HRT",
      "component_study_variables": ["phs000200.v11.pht000998.v6.phv00078436.v6", "phs000200.v11.pht000998.v6.phv00078437.v6", "phs000200.v11.pht001031.v6.phv00080426.v6"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n\n  # age at start of VTE follow-up for WHI HRT participants\n  # follow-up started at baseline so age = age at enrollment\n\n  # get dataset with screening information\n  # get dataset with membership flags and select HRT participants\n  # combine datasets\n\n  dat1 <- phen_list$source_data$pht000998\n  dat2 <- phen_list$source_data$pht001031 %>% filter(HRTFLAG %in% 1)\n  dat <- left_join(dat2, dat1)\n\n  # create desired age variable = age at enrollment\n  # AGE is measured at screening on form F2\n  # abs(F2DAYS) is days between screening and enrollment\n  # do not use F2DAYS when F2DAYS > 0\n\n  dat$F2DAYS <- as.numeric(dat$F2DAYS)\n  dat$AGE <- as.numeric(dat$AGE)\n\n  dat <- dat %>%\n         mutate(F2DAYS = ifelse(F2DAYS > 0, 0, F2DAYS)) %>%\n         mutate(vte_followup_start_age = AGE + abs(F2DAYS) / 365.25) %>%\n         filter(!is.na(vte_followup_start_age)) %>%\n         select(topmed_subject_id, vte_followup_start_age)\n\n  return(dat)\n}\n"
    },
    {
      "name": "WHI_MRCnonHRT",
      "component_study_variables": ["phs000200.v11.pht000998.v6.phv00078436.v6", "phs000200.v11.pht000998.v6.phv00078437.v6", "phs000200.v11.pht001031.v6.phv00080426.v6", "phs000200.v11.pht003395.v3.phv00192301.v3", "phs000200.v11.pht003395.v3.phv00192302.v3"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n  # age at start of VTE follow-up for WHI MRC non-HRT participants\n  # follow-up started at beginning of Extension 2\n  # so age = age at enrollment + (days to Ext2)/365.25\n\n  # get dataset with screening information to compute age at enrollment\n  dat1 <- phen_list$source_data$pht000998\n\n  # get datasets with membership flags and combine\n  dat2 <- phen_list$source_data$pht001031  # HRTFLAG\n  dat3 <- phen_list$source_data$pht003395  # EXT2MRC, EXT2DAYS\n  datt <- full_join(dat3, dat2)\n\n  # select subjects in MRC but not in HRT\n  datt <- datt %>% filter(EXT2MRC %in% 1 & HRTFLAG %in% 0)\n\n  # combine with screening info\n  dat <- left_join(datt, dat1)\n\n  # create desired age variable = age at enrollment + (days to Ext2)/365.25\n  # AGE is measured at screening on form F2\n  # abs(F2DAYS) is days between screening and enrollment\n  # do not use F2DAYS when F2DAYS > 0\n  # age at enrollment = AGE + abs(F2DAYS)/365.25\n\n  # change to numeric variables\n  dat$F2DAYS <- as.numeric(dat$F2DAYS)\n  dat$AGE <- as.numeric(dat$AGE)\n  dat$EXT2DAYS <- as.numeric(dat$EXT2DAYS)\n\n  dat <- dat %>%\n         mutate(F2DAYS = ifelse(F2DAYS > 0, 0, F2DAYS)) %>%\n         mutate(vte_followup_start_age = AGE + (abs(F2DAYS) + EXT2DAYS) / 365.25) %>%\n         filter(!is.na(vte_followup_start_age)) %>%\n         select(topmed_subject_id, vte_followup_start_age)\n\n  return(dat)\n}\n"
    }
  ]
}
