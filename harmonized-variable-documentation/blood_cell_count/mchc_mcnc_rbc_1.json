{
  "name": "mchc_mcnc_rbc_1",
  "phenotype_concept": "mchc_mcnc_rbc",
  "concept_variant": 1,
  "description": "Measurement of the mass concentration (mcnc) of hemoglobin in a given volume of packed red blood cells (rbc), known as mean corpuscular hemoglobin concentration (MCHC).",
  "version": 3,
  "dcc_harmonization_id": 112,
  "data_type": "decimal",
  "measurement_units": "g /dL = grams per deciliter",
  "has_age_variable": true,
  "date_harmonized": "2018-09-28 15:25:04",
  "dcc_harmonization_comments": "For studies which had no MCHC study component variable but hemoglobin and hematocrit study component variables were available, harmonized MCHC values were calculated using the formula:\n```\n100 *  hemoglobin / hematocrit .\n```\nIf a study had MCHC, hemoglobin, and hematocrit component variables, the values of MCHC as provided by the study were used directly unless there were many missing values, in which case the harmonized MCHC values were calculated from hemoglobin and hematocrit using the above formula.  For most of the studies, MCHC values were calculated in this manner. The study-specific comments indicate for which studies the MCHC values as provided by the study were used directly. \n\nFor studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study. The values were first calculated as above using data from each visit and then a visit for a given subject was selected. \n\n### Study-specific comments\n\n#### FHS\nOnly the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen because more recent exams used more up-to-date procedures. \n\nThe values of MCHC as provided by the study were used directly for the harmonization.\n\n#### JHS\nThe values of MCHC as provided by the study were used directly for the harmonization.\n\n#### ARIC\nThe visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. \n\nBecause of missingness patterns across the visits, calculated values were used in order to maximize sample size.\n\n#### Amish\nSubjects with age recorded as 90+ were assigned a harmonized age of 90.\n\n### QC checks\n\nFor studies with MCHC, hemoglobin, and hematocrit study component variables, the calculated values from hemoglobin and hematocrit were compared with the given values in the MCHC study component variable. There was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.\n\nPlease note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for hemoglobin, hematocrit, and MCHC may not be from the same visit.\n",
  "encoded_values": [],
  "controlled_vocabulary": [
    {
      "source": "UMLS",
      "version": "2019AA",
      "id": "C0944134"
    }
  ],
  "harmonization_units": [
    {
      "name": "Amish",
      "component_study_variables": ["phs000956.v2.pht005002.v1.phv00252976.v1", "phs000956.v2.pht005002.v1.phv00253007.v1", "phs000956.v2.pht005002.v1.phv00253008.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n\n   # MCHC = hemoglobin/hematocrit * 100\n   #   units = g/dL  mean corpuscular hemoglobin concentration\n   # no data given so derive trait\n  source_data <- phen_list$source_data\n  dataset <- source_data[[\"pht005002\"]]\n  dataset$hematocrit_baseline <- as.numeric(dataset$hematocrit_baseline)\n  dataset$hemoglobin_baseline <- as.numeric(dataset$hemoglobin_baseline)\n  dataset$mchc_mcnc_rbc <- dataset$hemoglobin_baseline / dataset$hematocrit_baseline * 100\n  dataset$hematocrit_baseline <- NULL\n  dataset$hemoglobin_baseline <- NULL\n\n   # age - winsorize at 90\n   dataset$age_baseline[dataset$age_baseline %in% \"90+\"] <- 90\n   dataset$age_baseline <- as.numeric(dataset$age_baseline)\n   names(dataset)[names(dataset) %in% \"age_baseline\"] <- \"age\"\n\n   # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)\n  dataset <- dataset[sel, ]\n\n return(dataset)\n}\n"
    },
    {
      "name": "ARIC",
      "component_study_variables": ["phs000280.v4.pht004062.v2.phv00204623.v1", "phs000280.v4.pht004063.v2.phv00204712.v1", "phs000280.v4.pht004064.v2.phv00204871.v1", "phs000280.v4.pht004065.v2.phv00204975.v1", "phs000280.v4.pht004107.v2.phv00207255.v1", "phs000280.v4.pht004107.v2.phv00207256.v1", "phs000280.v4.pht004108.v2.phv00207270.v1", "phs000280.v4.pht004108.v2.phv00207271.v1", "phs000280.v4.pht004109.v2.phv00207288.v1", "phs000280.v4.pht004109.v2.phv00207289.v1", "phs000280.v4.pht004110.v2.phv00207300.v1", "phs000280.v4.pht004110.v2.phv00207301.v1", "phs000280.v4.pht006422.v1.phv00294956.v1", "phs000280.v4.pht006422.v1.phv00294957.v1", "phs000280.v4.pht006431.v1.phv00295623.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list){\n    library(dplyr)\n    library(magrittr)\n    # MCHC mean corpuscular hemoglobin concentration g/dL\n    # to maximize sample size, will derive MCHC from hemoglogin and hematocrit\n    # all visits have hemoglobin and hematocrit\n\n    source_data <- phen_list$source_data\n\n    # Age at visit\n    dem1 <- phen_list$source_data[[\"pht004063\"]] %>%\n        mutate(visit = 1, age = as.numeric(V1AGE01))\n    dem2 <- phen_list$source_data[[\"pht004062\"]] %>%\n        mutate(visit = 2, age = as.numeric(V2AGE22))\n    dem3 <- phen_list$source_data[[\"pht004064\"]] %>%\n        mutate(visit = 3, age = as.numeric(V3AGE31))\n    dem4 <- phen_list$source_data[[\"pht004065\"]] %>%\n        mutate(visit = 4, age = as.numeric(V4AGE41))\n    dem5 <- phen_list$source_data[[\"pht006431\"]] %>%\n        mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))\n\n    dem <- list(dem1, dem2, dem3, dem4, dem5) %>%\n        lapply(select, topmed_subject_id, visit, age) %>%\n        do.call(rbind, .) %>%\n        tbl_df %>%\n        filter(!is.na(visit) & !is.na(age))\n\n   # get data for hemoglobin and hematocrit, eliminate subjects with missing codes\n   # derive MCHC = hemoglobin/hematocrit * 100\n    blood1 <- source_data[[\"pht004107\"]] %>%\n        filter(!(HMTA02 %in% c(\"A\", \"O\")) & !(HMTA01 %in% c(\"A\", \"O\"))) %>%\n        mutate(visit = 1, mchc_mcnc_rbc = as.numeric(HMTA02) / as.numeric(HMTA01) * 100)\n    blood2 <- source_data[[\"pht004108\"]] %>%\n        filter(!(HMTB02 %in% c(\"A\", \"O\")) & !(HMTB01 %in% c(\"A\", \"O\"))) %>%\n        mutate(visit = 2, mchc_mcnc_rbc = as.numeric(HMTB02) / as.numeric(HMTB01) * 100)\n    blood3 <- source_data[[\"pht004109\"]] %>%\n        filter(!(HMTC4 %in% c(\"A\", \"O\")) & !(HMTC5 %in% c(\"A\", \"O\"))) %>%\n        mutate(visit = 3, mchc_mcnc_rbc = as.numeric(HMTC4) / as.numeric(HMTC5) * 100)\n    blood4 <- source_data[[\"pht004110\"]] %>%\n        filter(!(HMTC4 %in% c(\"A\", \"O\")) & !(HMTC5 %in% c(\"A\", \"O\"))) %>%\n        mutate(visit = 4, mchc_mcnc_rbc = as.numeric(HMTC4) / as.numeric(HMTC5) * 100)\n    blood5 <- source_data[[\"pht006422\"]] %>%\n        filter(!(CBC5 %in% c(\"A\", \"O\")) & !(CBC6 %in% c(\"A\", \"O\"))) %>%\n        mutate(visit = 5, mchc_mcnc_rbc = as.numeric(CBC5) / as.numeric(CBC6) * 100)\n\n    blood <- list(blood1, blood2, blood3, blood4, blood5)\n    for (i in seq_along(blood)){\n        blood[[i]] %<>%\n            tbl_df %>%\n            select(topmed_subject_id, visit, mchc_mcnc_rbc) %>%\n            na.omit()\n    }\n\n    blood %<>% do.call(rbind, .)\n\n    dataset <- left_join(blood, dem, c(\"topmed_subject_id\", \"visit\"))\n\n    # Successively select from visit with most observations for additional subjects\n    datafnl <- NULL\n    while (nrow(dataset) > 0){\n     # create table of number of subjects per visit\n      tb <- dataset %>% group_by(visit) %>%\n            summarise(count = n())\n     # order the table in decreasing order, choose the top visit (most subjects)\n      tb <- tb[order(tb$count, decreasing = TRUE), ]\n      v <- tb %>% slice(1) %>% select(visit)\n      v <- as.numeric(v)\n     # select subjects with that visit\n      tmp <- dataset %>% filter(visit == v)\n      datafnl <- rbind(datafnl, tmp)\n     # remove chosen set of subjects and repeat the process with remaining subjects\n      dataset <- anti_join(dataset, tmp, by = \"topmed_subject_id\")\n    }\n   datafnl <- datafnl %>% select(topmed_subject_id, mchc_mcnc_rbc, age) %>% na.omit\n   return(datafnl)\n}\n"
    },
    {
      "name": "CARDIA",
      "component_study_variables": ["phs000285.v3.pht001559.v2.phv00112439.v2", "phs000285.v3.pht001563.v2.phv00112688.v2", "phs000285.v3.pht001563.v2.phv00112689.v2"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list){\n    library(dplyr)\n    library(magrittr)\n    # Age at measurement (Exam 1)\n    dat1 <- phen_list$source_data[[\"pht001559\"]] %>%\n        tbl_df() %>%\n        transmute(topmed_subject_id, age = as.numeric(A01AGE2))\n\n    # Mean corpuscular hemoglobin concentration MCHC (g/dL)\n    # not given but can derive from hemoglobin and hematocrit\n    # MCHC = hemoglogin/hematocrit * 100\n    # get variables, eliminate subjects with missing code \"M\", derive\n    dat2 <- phen_list$source_data[[\"pht001563\"]] %>%\n        tbl_df() %>% filter(!(A05HGB %in% \"M\") & !(A05HCT %in% \"M\")) %>%\n        mutate(mchc_mcnc_rbc = as.numeric(A05HGB) / as.numeric(A05HCT) * 100)\n\n    dataset <- left_join(dat2, dat1, by = \"topmed_subject_id\") %>%\n        select(topmed_subject_id, mchc_mcnc_rbc, age) %>% na.omit()\n\n    return(dataset)\n}\n"
    },
    {
      "name": "CHS",
      "component_study_variables": ["phs000287.v6.pht001452.v1.phv00100412.v1", "phs000287.v6.pht001452.v1.phv00100413.v1", "phs000287.v6.pht001452.v1.phv00100487.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list){\n    library(dplyr)\n    library(magrittr)\n    # Mean corpuscular hemoglobin concentration MCHC (g/dL)\n    # not given but can be derived from hemoglobin and hematocrit\n    # MCHC = hemoglobin/hematocrit * 100\n    # get variables and derive\n\n    dataset <- phen_list$source_data[[\"pht001452\"]] %>%\n         mutate(mchc_mcnc_rbc = as.numeric(HEMOGL23) / as.numeric(HEMATO23) * 100,\n         age = as.integer(AGEBL)) %>%\n         select(topmed_subject_id, age, mchc_mcnc_rbc) %>% na.omit\n\n    return(dataset)\n}\n"
    },
    {
      "name": "FHS_Gen3NOSOmni2",
      "component_study_variables": ["phs000007.v29.pht002889.v2.phv00172184.v2", "phs000007.v29.pht003099.v4.phv00177932.v4"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n\n  source_data <- phen_list$source_data\n # mchc_mcnc_rbc units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration\n  dataset1 <- source_data[[\"pht002889\"]]\n  dataset1$MCHC <- as.numeric(dataset1$MCHC)\n  names(dataset1)[names(dataset1) %in% \"MCHC\"] <- \"mchc_mcnc_rbc\"\n\n  # age\n  dataset2 <- source_data[[\"pht003099\"]]\n  dataset2$age2 <- as.numeric(dataset2$age2)\n  names(dataset2)[names(dataset2) %in% \"age2\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)\n  dataset <- dataset[sel, ]\n\n  return(dataset)\n}\n"
    },
    {
      "name": "FHS_Offspring",
      "component_study_variables": ["phs000007.v29.pht000030.v7.phv00007646.v5", "phs000007.v29.pht000031.v7.phv00008114.v5", "phs000007.v29.pht003099.v4.phv00177930.v4", "phs000007.v29.pht003099.v4.phv00177932.v4", "phs000007.v29.pht003099.v4.phv00177946.v4", "phs000007.v29.pht004802.v1.phv00227024.v1", "phs000007.v29.pht004802.v1.phv00227031.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n\n  source_data <- phen_list$source_data\n  # MCHC units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration\n  var <- \"mchc_mcnc_rbc\"\n\n  # Offspring exam 9\n  dataset9 <- source_data[[\"pht004802\"]]\n  # subset to Offspring\n  dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]\n  dataset9$IDTYPE <- NULL\n\n  dataset9$MCHC <- as.numeric(dataset9$MCHC)\n\n  # Offspring exam 2\n  dataset2 <- source_data[[\"pht000031\"]]\n  dataset2$B767 <- as.numeric(dataset2$B767)\n\n  # Recode: g/L - recode to g/dL\n  dataset2$B767 <- dataset2$B767 / 10\n\n   # Offspring exam 1\n  dataset1 <- source_data[[\"pht000030\"]]\n  dataset1$A144 <- as.numeric(dataset1$A144)\n\n  # Recode: g/L - recode to g/dL\n  dataset1$A144 <- dataset1$A144 / 10\n\n  # ages\n  dataseta <- source_data[[\"pht003099\"]]\n  dataseta$age9 <- as.numeric(dataseta$age9)\n  dataseta$age2 <- as.numeric(dataseta$age2)\n  dataseta$age1 <- as.numeric(dataseta$age1)\n\n  # add appropriate ages to datasets\n  dataset9 <- inner_join(dataset9, dataseta)\n  dataset9$age2 <- NULL\n  dataset9$age1 <- NULL\n\n  dataset2 <- inner_join(dataset2, dataseta)\n  dataset2$age9 <- NULL\n  dataset2$age1 <- NULL\n\n  dataset1 <- inner_join(dataset1, dataseta)\n  dataset1$age9 <- NULL\n  dataset1$age2 <- NULL\n\n  sel <- !is.na(dataset9$MCHC) & !is.na(dataset9$age9)\n  keep9 <- dataset9[sel, ]\n  names(keep9)[names(keep9) == \"MCHC\"] <- var\n  names(keep9)[names(keep9) == \"age9\"] <- \"age\"\n\n  dataset2 <- anti_join(dataset2, keep9)\n  sel2 <- !is.na(dataset2$B767) & !is.na(dataset2$age2)\n  keep2 <- dataset2[sel2, ]\n  names(keep2)[names(keep2) == \"B767\"] <- var\n  names(keep2)[names(keep2) == \"age2\"] <- \"age\"\n\n  keep <- rbind(keep9, keep2)\n\n  dataset1 <- anti_join(dataset1, keep)\n  sel1 <-  !is.na(dataset1$A144) & !is.na(dataset1$age1)\n  keep1 <- dataset1[sel1, ]\n  names(keep1)[names(keep1) == \"A144\"] <- var\n  names(keep1)[names(keep1) == \"age1\"] <- \"age\"\n\n  # combine\n  dataset <- rbind(keep, keep1)\n\n  return(dataset)\n}\n"
    },
    {
      "name": "FHS_Omni1",
      "component_study_variables": ["phs000007.v29.pht003099.v4.phv00177936.v4", "phs000007.v29.pht004802.v1.phv00227024.v1", "phs000007.v29.pht004802.v1.phv00227031.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n\n  source_data <- phen_list$source_data\n  dataset1 <- source_data[[\"pht004802\"]]\n  # choose Omni1 cohort\n  dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]\n\n   # mchc_mcnc_rbc units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration\n  dataset1$MCHC <- as.numeric(dataset1$MCHC)\n  names(dataset1)[names(dataset1) %in% \"MCHC\"] <- \"mchc_mcnc_rbc\"\n  dataset1$IDTYPE <- NULL\n\n  # age\n  dataset2 <- source_data[[\"pht003099\"]]\n  dataset2$age4 <- as.numeric(dataset2$age4)\n  names(dataset2)[names(dataset2) %in% \"age4\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)\n  dataset <- dataset[sel, ]\n\n  return(dataset)\n}\n"
    },
    {
      "name": "HCHS_SOL",
      "component_study_variables": ["phs000810.v1.pht004715.v1.phv00226251.v1", "phs000810.v1.pht004715.v1.phv00226306.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list){\n    library(dplyr)\n    library(magrittr)\n    # Mean corpuscular hemoglobin concentration (MCHC) (pg) and age at measurement\n\n    dataset <- phen_list$source_data[[\"pht004715\"]] %>%\n        tbl_df %>%\n        mutate(mchc_mcnc_rbc = as.numeric(LABA7),\n            age = as.integer(AGE)) %>%\n        select(topmed_subject_id, age, mchc_mcnc_rbc) %>%\n        filter(!is.na(age), !is.na(mchc_mcnc_rbc))\n\n    return(dataset)\n}\n"
    },
    {
      "name": "JHS",
      "component_study_variables": ["phs000286.v5.pht001949.v1.phv00126009.v1", "phs000286.v5.pht001959.v1.phv00127624.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n\n  source_data <- phen_list$source_data\n   # mchc_mcnc_rbc units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration\n  dataset1 <- source_data[[\"pht001959\"]]\n  dataset1$MCHC <- as.numeric(dataset1$MCHC)\n  names(dataset1)[names(dataset1) %in% \"MCHC\"] <- \"mchc_mcnc_rbc\"\n\n  # age\n  dataset2 <- source_data[[\"pht001949\"]]\n  dataset2$AGE01 <- as.numeric(dataset2$AGE01)\n  names(dataset2)[names(dataset2) %in% \"AGE01\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)\n  dataset <- dataset[sel, ]\n\n  return(dataset)\n}\n"
    },
    {
      "name": "MESA",
      "component_study_variables": ["phs000209.v13.pht003091.v3.phv00176011.v1", "phs000209.v13.pht004319.v1.phv00218992.v1", "phs000209.v13.pht004319.v1.phv00218993.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n\n  source_data <- phen_list$source_data\n   # mchc_mcnc_rbc  units = g/dL (grams/deciliter) mean corpuscular hemoglobin concentration\n  # measured at exam 5\n   # derive from hemoglobin and hematocrit\n\n   dataset1 <- source_data[[\"pht004319\"]]\n  dataset1$mchc_mcnc_rbc <- as.numeric(dataset1$hgb5) / as.numeric(dataset1$hct5) * 100\n\n  # age\n  dataset2 <- source_data[[\"pht003091\"]]\n  dataset2$age5c <- as.numeric(dataset2$age5c)\n  names(dataset2)[names(dataset2) %in% \"age5c\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mchc_mcnc_rbc)\n  dataset <- dataset[sel, ]\n\n  dataset <- dataset %>% select(c(topmed_subject_id, mchc_mcnc_rbc, age))\n\n  return(dataset)\n}\n"
    }
  ]
}
