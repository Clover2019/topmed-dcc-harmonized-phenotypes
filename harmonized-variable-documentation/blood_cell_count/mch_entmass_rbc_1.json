{
  "name": "mch_entmass_rbc_1",
  "phenotype_concept": "mch_entmass_rbc",
  "concept_variant": 1,
  "description": "Measurement of the average mass (entmass) of hemoglobin per red blood cell(rbc), known as mean corpuscular hemoglobin (MCH).",
  "version": 3,
  "dcc_harmonization_id": 113,
  "data_type": "decimal",
  "measurement_units": "pg = picogram",
  "has_age_variable": true,
  "date_harmonized": "2018-09-28 15:25:19",
  "dcc_harmonization_comments": "For most studies, the values of mean corpuscular hemoglobin (MCH) as provided by the study were used directly. When a study did not provide a variable for MCH, harmonized MCH values were derived from hemoglobin and red blood cell count study component variables, if available, using the formula:\n```\n10 * hemoglobin / red blood cell count .\n```\nFor studies or cohorts with measurements at more than one visit, in order to maximize sample size, one measurement per subject was selected, rather than choosing the same visit for all subjects. This was done on a trait-by-trait basis. The algorithm for choosing a visit for a subject differed by study. \n\n### Study-specific comments\n\n#### FHS\nOnly the Offspring subcohort had measurements at multiple visits (exams). For this subcohort, the measurement at the most recent exam available was chosen because more recent exams used more up-to-date procedures. \n\n#### ARIC\nThe visit with the most non-missing phenotype values was chosen first. For subjects without measurements at this visit, the visit with the next most non-missing values was chosen, and so forth in succession. \n\n#### Amish\nSubjects with age recorded as 90+ were assigned a harmonized age of 90.\n\n### QC checks\n\nFor studies with MCH, hemoglobin, and red blood cell count study component variables, the calculated values from hemoglobin and red blood cell count were compared with the given values in the MCH study component variable.\n\nFor *_MESA_*, this QC detected apparent recording errors in some MCH values and led to the decision to use calculated values.\n\nFor other studies, there was a small percentage of subjects for which the comparison showed a relative error greater than 5%.  No data were removed based on these observations.\n\nPlease note that visit selection to maximize sample size introduced the possibility that related _harmonized_ hematology variables may be measured at different visits for a given subject. For example, for any given subject, the _harmonized_ values for hemoglobin, red blood cell count, and MCH may not be from the same visit.\n",
  "encoded_values": [],
  "controlled_vocabulary": [
    {
      "source": "UMLS",
      "version": "2019AA",
      "id": "C0945625"
    }
  ],
  "harmonization_units": [
    {
      "name": "Amish",
      "component_study_variables": ["phs000956.v2.pht005002.v1.phv00252976.v1", "phs000956.v2.pht005002.v1.phv00253007.v1", "phs000956.v2.pht005002.v1.phv00253010.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(dplyr)\n  source_data <- phen_list$source_data\n\n   # MCH = hemoglobin/RBC * 10 units = pg (picograms) mean corpuscular hemoglobin\n  dataset <- source_data[[\"pht005002\"]]\n  dataset$red_blood_cell_count_baseline <- as.numeric(dataset$red_blood_cell_count_baseline)\n  dataset$hemoglobin_baseline <- as.numeric(dataset$hemoglobin_baseline)\n  dataset <- dataset %>%\n    mutate(mch_entmass_rbc = hemoglobin_baseline / red_blood_cell_count_baseline * 10)\n\n   # age - winsorize at 90\n   dataset$age_baseline[dataset$age_baseline %in% \"90+\"] <- 90\n   dataset$age_baseline <- as.numeric(dataset$age_baseline)\n   names(dataset)[names(dataset) %in% \"age_baseline\"] <- \"age\"\n\n   # subset to non-missing values\n   dataset <- dataset %>% filter(!is.na(age) & !is.na(mch_entmass_rbc)) %>%\n       select(topmed_subject_id, mch_entmass_rbc, age)\n\n  return(dataset)\n}\n"
    },
    {
      "name": "ARIC",
      "component_study_variables": ["phs000280.v4.pht004064.v2.phv00204871.v1", "phs000280.v4.pht004065.v2.phv00204975.v1", "phs000280.v4.pht004109.v2.phv00207290.v1", "phs000280.v4.pht004110.v2.phv00207302.v1", "phs000280.v4.pht006422.v1.phv00294960.v1", "phs000280.v4.pht006431.v1.phv00295623.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list){\n    library(dplyr)\n    library(magrittr)\n\n    # Mean corpuscular hemoglobin MCH (pg) - only measured at visit 3, 4, and 5\n    # Age at visit\n    dem3 <- phen_list$source_data[[\"pht004064\"]] %>%\n        mutate(visit = 3, age = as.numeric(V3AGE31))\n    dem4 <- phen_list$source_data[[\"pht004065\"]] %>%\n        mutate(visit = 4, age = as.numeric(V4AGE41))\n    dem5 <- phen_list$source_data[[\"pht006431\"]] %>%\n        mutate(visit  = 5, age = as.numeric(AGE_STAGE_1))\n\n    dem <- list(dem3, dem4, dem5) %>%\n        lapply(select, topmed_subject_id, visit, age) %>%\n        do.call(rbind, .) %>%\n        tbl_df %>%\n        filter(!is.na(visit) & !is.na(age))\n\n    # get MCH data for each visit, eliminate subjects with missing codes\n    blood3 <- phen_list$source_data[[\"pht004109\"]] %>%\n        filter(!(HMTC7 %in% c(\"A\", \"O\")) ) %>%\n        mutate(visit = 3, mch_entmass_rbc = as.numeric(HMTC7))\n    blood4 <- phen_list$source_data[[\"pht004110\"]] %>%\n        filter(!(HMTC7 %in% c(\"A\", \"O\")) ) %>%\n        mutate(visit = 4, mch_entmass_rbc = as.numeric(HMTC7))\n    blood5 <- phen_list$source_data[[\"pht006422\"]] %>%\n        filter(!(CBC9 %in% c(\"A\", \"O\")) ) %>%\n        mutate(visit = 5, mch_entmass_rbc = as.numeric(CBC9))\n\n    blood <- list(blood3, blood4, blood5) %>%\n        lapply(select, topmed_subject_id, visit, mch_entmass_rbc) %>%\n        lapply(na.omit)\n\n    blood %<>% do.call(rbind, .)\n\n    dataset <- left_join(blood, dem, c(\"topmed_subject_id\", \"visit\"))\n\n    # Successively select from visit with most observations for additional subjects\n    datafnl <- NULL\n    while (nrow(dataset) > 0){\n     # create table of number of subjects per visit\n      tb <- dataset %>% group_by(visit) %>%\n            summarise(count = n())\n     # order the table in decreasing order, choose the top visit (most subjects)\n      tb <- tb[order(tb$count, decreasing = TRUE), ]\n      v <- tb %>% slice(1) %>% select(visit)\n      v <- as.numeric(v)\n     # select subjects with that visit\n      tmp <- dataset %>% filter(visit == v)\n      datafnl <- rbind(datafnl, tmp)\n     # remove chosen set of subjects and repeat the process with remaining subjects\n      dataset <- anti_join(dataset, tmp, by = \"topmed_subject_id\")\n    }\n   datafnl <- datafnl %>% select(topmed_subject_id, mch_entmass_rbc, age) %>% na.omit\n   return(datafnl)\n}\n"
    },
    {
      "name": "CARDIA",
      "component_study_variables": ["phs000285.v3.pht001559.v2.phv00112439.v2", "phs000285.v3.pht001563.v2.phv00112687.v2", "phs000285.v3.pht001563.v2.phv00112688.v2"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list){\n    library(dplyr)\n    library(magrittr)\n    # Age at measurement (Exam 1)\n    dat1 <- phen_list$source_data[[\"pht001559\"]] %>%\n        tbl_df() %>%\n        transmute(topmed_subject_id, age = as.numeric(A01AGE2))\n\n    # Mean corpuscular hemoglobin MCH (pg)\n    # not given but can derive from hemoglobin and red blood cell count (RBC)\n    # MCH = hemoglobin/RBC * 10\n    # get variables, eliminate subjects with missing code \"M\", derive\n    dat2 <- phen_list$source_data[[\"pht001563\"]] %>%\n        tbl_df() %>% filter(!(A05HGB %in% \"M\") & !(A05RBC %in% \"M\")) %>%\n        mutate(mch_entmass_rbc = as.numeric(A05HGB) / as.numeric(A05RBC) * 10)\n\n    dataset <- left_join(dat2, dat1, by = \"topmed_subject_id\") %>%\n        select(topmed_subject_id, mch_entmass_rbc, age) %>% na.omit()\n\n    return(dataset)\n}\n"
    },
    {
      "name": "FHS_Gen3NOSOmni2",
      "component_study_variables": ["phs000007.v29.pht002889.v2.phv00172183.v2", "phs000007.v29.pht003099.v4.phv00177932.v4"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n  source_data <- phen_list$source_data\n\n   # mch_entmass_rbc units = pg (picograms) mean corpuscular hemoglobin\n  dataset1 <- source_data[[\"pht002889\"]]\n  dataset1$MCH <- as.numeric(dataset1$MCH)\n  names(dataset1)[names(dataset1) %in% \"MCH\"] <- \"mch_entmass_rbc\"\n\n  # age\n  dataset2 <- source_data[[\"pht003099\"]]\n  dataset2$age2 <- as.numeric(dataset2$age2)\n  names(dataset2)[names(dataset2) %in% \"age2\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)\n  dataset <- dataset[sel, ]\n\n  return(dataset)\n}\n"
    },
    {
      "name": "FHS_Offspring",
      "component_study_variables": ["phs000007.v29.pht000030.v7.phv00007645.v5", "phs000007.v29.pht000031.v7.phv00008113.v5", "phs000007.v29.pht003099.v4.phv00177930.v4", "phs000007.v29.pht003099.v4.phv00177932.v4", "phs000007.v29.pht003099.v4.phv00177946.v4", "phs000007.v29.pht004802.v1.phv00227024.v1", "phs000007.v29.pht004802.v1.phv00227030.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n  source_data <- phen_list$source_data\n   # MCH units = pg (picograms) mean corpuscular hemoglobin\n  var <- \"mch_entmass_rbc\"\n\n  # Offspring exam 9\n  dataset9 <- source_data[[\"pht004802\"]]\n  # subset to Offspring\n  dataset9 <- dataset9[dataset9$IDTYPE %in% 1, ]\n  dataset9$IDTYPE <- NULL\n\n  dataset9$MCH <- as.numeric(dataset9$MCH)\n\n  # Offspring exam 2\n  dataset2 <- source_data[[\"pht000031\"]]\n  dataset2$B766 <- as.numeric(dataset2$B766)\n\n  # Recode: tens of pg - recode to pg (picogram)\n  dataset2$B766 <- dataset2$B766 / 10\n\n   # Offspring exam 1\n  dataset1 <- source_data[[\"pht000030\"]]\n  dataset1$A143 <- as.numeric(dataset1$A143)\n\n  # Recode: tens of pg - recode to pg (picogram)\n  dataset1$A143 <- dataset1$A143 / 10\n\n  # ages\n  dataseta <- source_data[[\"pht003099\"]]\n  dataseta$age9 <- as.numeric(dataseta$age9)\n  dataseta$age2 <- as.numeric(dataseta$age2)\n  dataseta$age1 <- as.numeric(dataseta$age1)\n\n  # add appropriate ages to datasets\n  dataset9 <- inner_join(dataset9, dataseta)\n  dataset9$age2 <- NULL\n  dataset9$age1 <- NULL\n\n  dataset2 <- inner_join(dataset2, dataseta)\n  dataset2$age9 <- NULL\n  dataset2$age1 <- NULL\n\n  dataset1 <- inner_join(dataset1, dataseta)\n  dataset1$age9 <- NULL\n  dataset1$age2 <- NULL\n\n  sel <- !is.na(dataset9$MCH) & !is.na(dataset9$age9)\n  keep9 <- dataset9[sel, ]\n  names(keep9)[names(keep9) == \"MCH\"] <- var\n  names(keep9)[names(keep9) == \"age9\"] <- \"age\"\n\n  dataset2 <- anti_join(dataset2, keep9)\n  sel2 <- !is.na(dataset2$B766) & !is.na(dataset2$age2)\n  keep2 <- dataset2[sel2, ]\n  names(keep2)[names(keep2) == \"B766\"] <- var\n  names(keep2)[names(keep2) == \"age2\"] <- \"age\"\n\n  keep <- rbind(keep9, keep2)\n\n  dataset1 <- anti_join(dataset1, keep)\n  sel1 <-  !is.na(dataset1$A143) & !is.na(dataset1$age1)\n  keep1 <- dataset1[sel1, ]\n  names(keep1)[names(keep1) == \"A143\"] <- var\n  names(keep1)[names(keep1) == \"age1\"] <- \"age\"\n\n  # combine\n  dataset <- rbind(keep, keep1)\n\n  return(dataset)\n}\n"
    },
    {
      "name": "FHS_Omni1",
      "component_study_variables": ["phs000007.v29.pht003099.v4.phv00177936.v4", "phs000007.v29.pht004802.v1.phv00227024.v1", "phs000007.v29.pht004802.v1.phv00227030.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n  source_data <- phen_list$source_data\n\n  dataset1 <- source_data[[\"pht004802\"]]\n  # choose Omni1 cohort\n  dataset1 <- dataset1[dataset1$IDTYPE %in% 7, ]\n\n   # mch_entmass_rbc units = pg (picograms) mean corpuscular hemoglobin\n  dataset1$MCH <- as.numeric(dataset1$MCH)\n  names(dataset1)[names(dataset1) %in% \"MCH\"] <- \"mch_entmass_rbc\"\n  dataset1$IDTYPE <- NULL\n\n  # age\n  dataset2 <- source_data[[\"pht003099\"]]\n  dataset2$age4 <- as.numeric(dataset2$age4)\n  names(dataset2)[names(dataset2) %in% \"age4\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)\n  dataset <- dataset[sel, ]\n\n  return(dataset)\n}\n"
    },
    {
      "name": "HCHS_SOL",
      "component_study_variables": ["phs000810.v1.pht004715.v1.phv00226251.v1", "phs000810.v1.pht004715.v1.phv00226305.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list){\n    library(dplyr)\n    library(magrittr)\n    # Mean corpuscular hemoglobin(MCH) (pg) and age at measurement\n\n    dataset <- phen_list$source_data[[\"pht004715\"]] %>%\n        tbl_df %>%\n        mutate(mch_entmass_rbc = as.numeric(LABA6),\n            age = as.integer(AGE)) %>%\n        select(topmed_subject_id, age, mch_entmass_rbc) %>%\n        filter(!is.na(age), !is.na(mch_entmass_rbc))\n\n    return(dataset)\n}\n"
    },
    {
      "name": "JHS",
      "component_study_variables": ["phs000286.v5.pht001949.v1.phv00126009.v1", "phs000286.v5.pht001959.v1.phv00127623.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n\n  source_data <- phen_list$source_data\n   # mch_entmass_rbc  units = pg (picograms) mean corpuscular hemoglobin\n  dataset1 <- source_data[[\"pht001959\"]]\n  dataset1$MCH <- as.numeric(dataset1$MCH)\n  names(dataset1)[names(dataset1) %in% \"MCH\"] <- \"mch_entmass_rbc\"\n\n  # age\n  dataset2 <- source_data[[\"pht001949\"]]\n  dataset2$AGE01 <- as.numeric(dataset2$AGE01)\n  names(dataset2)[names(dataset2) %in% \"AGE01\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)\n  dataset <- dataset[sel, ]\n\n  return(dataset)\n}\n"
    },
    {
      "name": "MESA",
      "component_study_variables": ["phs000209.v13.pht003091.v3.phv00176011.v1", "phs000209.v13.pht004319.v1.phv00218990.v1", "phs000209.v13.pht004319.v1.phv00218993.v1"],
      "component_harmonized_variables": [],
      "harmonization_function": "harmonize <- function(phen_list) {\n  library(\"dplyr\")\n  source_data <- phen_list$source_data\n   # mch_entmass_rbc  units = pg (picograms) mean corpuscular hemoglobin\n   # measured at exam 5\n   # derive from hemoglobin and RBC since some given values are recording errors\n  dataset1 <- source_data[[\"pht004319\"]]\n  dataset1$mch_entmass_rbc <- as.numeric(dataset1$hgb5) / as.numeric(dataset1$rbc5) * 10\n\n  # age\n  dataset2 <- source_data[[\"pht003091\"]]\n  dataset2$age5c <- as.numeric(dataset2$age5c)\n  names(dataset2)[names(dataset2) %in% \"age5c\"] <- \"age\"\n\n  # combine\n  dataset <- inner_join(dataset1, dataset2)\n\n  # subset to non-missing values\n  sel <- !is.na(dataset$age) & !is.na(dataset$mch_entmass_rbc)\n  dataset <- dataset[sel, ]\n\n  # measurements are at Exam 5\n  dataset <- dataset %>% select(c(topmed_subject_id, mch_entmass_rbc, age))\n\n  return(dataset)\n}\n"
    }
  ]
}
